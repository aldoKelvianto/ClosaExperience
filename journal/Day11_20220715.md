Xcode build process

- The Xcode build process is built-from-scratch since XCode 10 in Swift.
- Build process: Execution of a collection of tasks. Such as:
	- Compile and link the source code
		- Compile PetViewController.m
		- Compile PetController.swift
		- Compile PetView.swift
	- Copy and process resources
		- Generate PetWall-Swift.h
		- Compile Assets.xcassets
		- Process Info.plist
		- Compile Main.storyboard
	- CodeSign and execute custom command
		- Run GenerateDocs.sh
		- CodeSign PetWall.app
		- Generate API documentation
		- Execute code linting

```
$ swiftc -module-name PetWall -target arm64-apple-ios12.0 -swift-version 4.2
$ clang -x objective-c -arch arm64 PetViewController.m -o PetViewController.o
$ ld -o PetWall -framework PetKit PetViewController.o
$ actool --app-icon AppIcon Assets.xcassets
...
[thousands more]
```

- Build process automate all that

- The build system `llbuild` is an open source project

---

Xcode Cloud

- Product -> Xcode Cloud -> Create Workflow..
Select the App (Fruta)
Xcode cloud generate default configuration for the workflow

- Workflow:
Start Condition
Environment
Actions
Post-actions

The default configuration:
Start condition: Every change to a branch (main)
Environment: Xcode 12.5
Actions: iOS, macOS
Post-Actions: No TestFlight deployments, no notifications

- Start condition
Connect Xcode cloud with source code provider (ex: GitHub)
You may need to perform additional task to grant access to Xcode cloud (on the web)

Register your app with App Store connect bundle id

Continue "Start a build" window to start build

- View results

Build group overview (right-most navigation menu)
You can see Local and Cloud
Top-right has "Rebuild" icon to rebuild the project
Archive has two sub-sections: Logs and Artifacts.
Logs is self-explanatory.
Artifacts contains logs, ad-hoc zip, app-store zip, xcresult archive, development.zip, etc.

- Submitting changes to master branch

You can use Source Control GUI to commit and push the code change. Or use terminal.

Both will invoke a build in the Xcode cloud

- Create a release build workflow

You can right click the "Default" workflow and choose "edit workflow" to modify the workflow configuration.

Start Condition -> release/v1 branch

Actions -> Add Test action type
You can select the destination, like iOS/macOS to run and the OS version

Start build to start build, and choose the release/v1 to kick-off the build.

---

Testflight

- You need to have an Apple ID and developer account, obviously

- Create a new Certificate ID
Certificates, Identifiers, & Profiles -> Identifiers -> Plus button -> App ID -> App.

Filled-out the App ID description.
The Bundle ID (Explicit), the capabilities, and the app description

- Create the app in the App store (App store connect)

New App (+)
Platforms
Name
Primary language
Bundle ID
SKU
User access

- Go to TestFlight tab
Submit a build

In your code, double-check your App version. Usually, for beta app, it's not using major version (semantic versioning). Like 0.1.0 instead of 1.0.0

Update version = Need mini-review. Update build = Instant approval. Yes, they need review, even for beta App.

- Click Product -> Archive
If the "Archive" button is greyed out, make sure the build target simulator is pointed to real iPhone or "Any iOS Device (arm64)"

- Archives -> Distribute App.
Select a method of distribution: App Store Connect.
Upload.
Include bitcode for iOS content
Upload your app's symbols to receive symbolicated reports from Apple
Automatically manage signing
Generate an Apple distribution certificate (one-time only)
Export signing certificate (p12 file)
Maybe add password to that certificate
Review (your app).ipa content.
Uploading..
Got an error (Distributed failed with errors). App store connect operation error (icon, plist, etc.)
Fix it, redo the same process.

- Go back to App Store Connect -> TestFlight to see your recently uploaded build.
Make sure it's ready to submit.

- Set internal group
Internal group is for user in your organization
External group is for user outside of your organization (E-mail/link)

- Click the build number to add more detail of your App.
Like test details, groups (Test information)
