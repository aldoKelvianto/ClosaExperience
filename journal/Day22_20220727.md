# Concurrency

## DispatchQueue

- Main vs Background Thread is abstracted to us through a Dispatch Queue.
- Main queue or background queue
 
```swift

DispatchQueue.main.async {
	self.foo()
}

DispatchQueue.global(qos: .background).async {
	self.foo()
	let jsonResponse = "{}"

	DispatchQueue.main.async {
		// Update UI
	}

}

func foo() {

}
```

- API call example

```swift
func getData() {
	guard let url = URL(string: "") else {
		return
	}

	let task = URLSession.shared.dataTask(with: url, completionHandler: {
		[weak self] data, response, error in 
			guard let data = data else {
				return
			}

			DispatchQueue.main.async {
				self?.view.backgroundColor = .red
			}
		})

	task.resume()
}

```

## Async/Await

- Min iOS version is 15, but you can use it for 13 with more code.

```swift
override func viewDidLoad() {
	super.viewDidLoad()
	async {
		let users = await fetchUsers()
		self.users = users
		DispatchQueue.main.async {
			self.tableView.reloadData()
		}
	}
}

func fetchUsers() async -> [User] {
	guard let url = url else {
		return []
	}

	do {
		let (data, _) = try await URLSession.shared.data(from: url)
		let users = try JSONDecoder().decode([User].self, from: data)
		return users
	} catch {
		return []
	}
}

```
